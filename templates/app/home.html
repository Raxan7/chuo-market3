{% extends 'app/base.html' %}
{% load static %}
{% load markdown_deux_tags %}
{% block title %}ChuoSmart - Premier Learning Management System in Tanzania{% endblock title %}

{% block meta_description %}Premier Learning Management System for college & university students in Tanzania. Access courses, interact with instructors, and enhance your education.{% endblock meta_description %}

{% block meta_keywords %}chuosmart, LMS, learning management system, online courses, education tanzania, student learning, college courses, university courses, online education{% endblock meta_keywords %}

<style>
  .hover-notification {
    position: fixed;
    top: 0;
    width: 100%;
    z-index: 1000;
    display: block;
  }

  .animated-text {
    animation: fadeInOut 2s infinite;
  }

  @keyframes fadeInOut {
    0%, 100% { opacity: 0; }
    50% { opacity: 1; }
  }

  .card-text {
    margin-bottom: 0.5rem;
  }
  .card-text.text-muted {
    font-size: 0.9rem;
  }
  @media (max-width: 768px) {
    .card {
      width: 100%;
    }
  }

  .carousel-control-prev-icon,
  .carousel-control-next-icon {
    background-color: rgb(8, 8, 8); /* Set the icon color to grey */
    box-shadow: 0 0 10px rgba(255, 255, 255, 0.8); /* Add a shining shadow */
    border-radius: 50%; /* Optional: Make the shadow circular */
  }
</style>

{% block banner_slider %}
<!-- Notification for missing customer details -->
{% if user.is_authenticated and not customers %}
<div class="alert alert-warning hover-notification" role="alert">
  Please <a href="{% url 'profile' %}" class="alert-link">update your profile</a> to make your shopping and selling experience smooth.
</div>
{% endif %}

<style>
  /* Banner Slider Styles */
  .banner-slider {
    position: relative;
    width: 100%;
    overflow: hidden;
    margin: 0 auto;
  }
  
  .banner-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0;
  }
  
  .carousel-inner {
    position: relative;
    width: 100%;
    overflow: hidden;
    border-radius: 8px;
  }
  
  .carousel-item {
    position: relative;
    width: 100%;
    /* Adjust this padding-top percentage based on your desired aspect ratio */
    /* 25% = 4:1, 33.33% = 3:1, 50% = 2:1, 56.25% = 16:9 (common banner ratio) */
    padding-top: 33.33%; /* Creates a 3:1 aspect ratio container */
  }
  
  .carousel-item img {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: contain; /* <-- changed from cover */
    object-position: center;
  }
 
  /* Responsive adjustments */
  @media (max-width: 992px) {
    .carousel-item {
      padding-top: 40%; /* Slightly taller aspect ratio on medium screens */
    }
  }
  
  @media (max-width: 768px) {
    .carousel-item {
      padding-top: 50%; /* Even taller aspect ratio on tablets */
    }
  }
  
  @media (max-width: 576px) {
    .carousel-item {
      padding-top: 60%; /* Tallest aspect ratio on mobile */
    }
    .carousel-inner {
      border-radius: 0; /* Full width on small screens */
    }
  }
</style>

<!-- Banner Slider -->
<div class="banner-slider">
  <div class="banner-container">
    <div id="carouselExampleControls" class="carousel slide" data-bs-ride="carousel">
      <div class="carousel-inner">
        {% for banner in banners %}
          <div class="carousel-item{% if forloop.first %} active{% endif %}">
            {% load image_tags %}
            {% if forloop.first %}
              <!-- Don't lazy load the first banner for faster initial display -->
              {% optimized_img src=banner.image.url alt=banner.title|default:'Banner image' css_class="d-block w-100" lazy=False %}
            {% else %}
              {% optimized_img src=banner.image.url alt=banner.title|default:'Banner image' css_class="d-block w-100" lazy=True %}
            {% endif %}
          </div>
        {% endfor %}
      </div>
      <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
      </a>
      <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
      </a>
    </div>
  </div>
</div>
<!-- End Banner Slider -->
{% endblock banner_slider %}

{% block chatbox %}
<!-- Chatbox Section -->
<div id="chatbox-section" class="d-flex justify-content-center">
  <div class="container border border-4 rounded shadow-lg m-2 p-2 bg-light d-flex flex-column" style="max-height: 400px; border-radius: 15px; box-shadow: 0 4px 8px rgba(255, 215, 0, 0.3); border-color: #0077be;">
    <h2 class="text-center text-primary mb-3" style="font-family: 'Comic Sans MS', cursive, sans-serif;">AI Lecturer</h2>
    <div id="chatbox-messages" style="flex: 1; overflow-y: auto;">
      <!-- Messages Section -->
      {% if messages %}
        {% for message in messages %}
          {% if message.user_message %}
          <div class="d-flex justify-content-end">
            <div class="p-2 m-1 bg-primary text-white rounded">
              <strong>User:</strong> {{ message.user_message|markdown }}
            </div>
          </div>
          {% endif %}
          {% if message.bot_response %}
          <div class="d-flex justify-content-start">
            <div class="p-2 m-1 bg-secondary text-white rounded">
              <strong>AI Lecturer:</strong> {{ message.bot_response|markdown }}
            </div>
          </div>
          {% endif %}
        {% endfor %}
      {% else %}
        <div class="d-flex justify-content-center">
          <div class="p-2 m-1 bg-light text-dark rounded animated-text">
            <strong>Ask AI Lecturer anything!</strong>
          </div>
        </div>
      {% endif %}
    </div>
    <div style="background-color: #f8f9fa;">
      <!-- Form Section -->
      <form action="{% url 'send_message' %}#chatbox-section" method="post" class="d-flex">
          {% csrf_token %}
          <textarea name="user_message" class="form-control me-2" style="background-color: #e9ecef;" placeholder="Niulize Chochote Nitakujibu ..."></textarea>
          <input type="submit" value="Send" class="btn btn-primary">
      </form>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    var chatboxMessages = document.getElementById("chatbox-messages");
    chatboxMessages.scrollTop = chatboxMessages.scrollHeight;
  });
</script>
{% endblock chatbox %}

{% block livesale %}
<!-- Live Sale Section -->
<div class="container">
</div>


<!-- End LMS Banner Section -->
{% endblock livesale %}

{% block main-content %}

<!-- LMS Feature Card -->
<div class="container my-5">
  <div class="row">
    <div class="col-md-12">
      <div class="card shadow border-0">
        <div class="row g-0">
          <div class="col-md-4 bg-primary text-white d-flex align-items-center">
            <div class="p-4 text-center">
              <i class="fas fa-graduation-cap fa-4x mb-3"></i>
              <h2 class="fw-bold">Learning Management System</h2>
              <p class="lead">Enhance your academic experience</p>
            </div>
          </div>
          <div class="col-md-8">
            <div class="card-body p-4">
              <h3 class="card-title fw-bold">Access Your Courses Online</h3>
              <p class="card-text">Our integrated Learning Management System provides:</p>
              <ul class="list-group list-group-flush mb-4">
                <li class="list-group-item"><i class="fas fa-check-circle text-success me-2"></i> Access to course materials and lectures</li>
                <li class="list-group-item"><i class="fas fa-check-circle text-success me-2"></i> Online quizzes and assessments</li>
                <li class="list-group-item"><i class="fas fa-check-circle text-success me-2"></i> Interact with instructors and fellow students</li>
                <li class="list-group-item"><i class="fas fa-check-circle text-success me-2"></i> Track your academic progress</li>
              </ul>
              <a href="{% url 'lms:lms_home' %}" class="btn btn-primary btn-lg">
                <i class="fas fa-arrow-right me-2"></i> Go to Learning Portal
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Available Courses Section -->
<div class="container my-5">
  {% if courses %}
    <div class="text-center mb-4">
      <h2 class="fw-bold">Featured Courses</h2>
      <p class="text-muted">Start learning with our top-rated courses</p>
    </div>
    
    <!-- Courses Grid -->
    <div class="row g-4">
      {% for course in courses %}
        <div class="col-lg-4 col-md-6 mb-4">
          <div class="card course-card h-100 shadow-sm border-0">
            {% if course.image %}
              <img src="{{ course.image.url }}" class="card-img-top course-image" alt="{{ course.title }}">
            {% else %}
              <div class="card-img-top course-image-placeholder d-flex align-items-center justify-content-center bg-light">
                <i class="fas fa-book fa-3x text-muted"></i>
              </div>
            {% endif %}
            
            <div class="card-body d-flex flex-column">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <span class="badge bg-primary">{{ course.category }}</span>
                <span class="text-muted small">
                  <i class="fas fa-clock"></i> {{ course.duration_weeks }} weeks
                </span>
              </div>
              
              <h5 class="card-title fw-bold">{{ course.title }}</h5>
              <p class="card-text text-muted">{{ course.description|truncatewords:20 }}</p>
              
              <div class="mt-auto">
                <div class="row align-items-center mb-3">
                  <div class="col-6">
                    <small class="text-muted">
                      <i class="fas fa-user"></i> {{ course.instructor.user.first_name }} {{ course.instructor.user.last_name }}
                    </small>
                  </div>
                  <div class="col-6 text-end">
                    <small class="text-muted">
                      <i class="fas fa-users"></i> {{ course.enrolled_students.count }} students
                    </small>
                  </div>
                </div>
                
                <div class="d-flex justify-content-between align-items-center">
                  {% if course.price > 0 %}
                    <span class="fw-bold text-success h5 mb-0">TSh {{ course.price }}</span>
                  {% else %}
                    <span class="badge bg-success">Free</span>
                  {% endif %}
                  <a href="{% url 'lms:course_detail' course.id %}" class="btn btn-primary">
                    View Course
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
    
    <div class="text-center mt-4">
      <a href="{% url 'lms:lms_home' %}" class="btn btn-outline-primary btn-lg">
        <i class="fas fa-graduation-cap me-2"></i> Browse All Courses
      </a>
    </div>
  {% else %}
    <div class="text-center mt-5">
      <i class="fas fa-graduation-cap fa-4x text-muted mb-3"></i>
      <h3>No courses available yet</h3>
      <p class="text-muted">Check back soon for exciting new courses!</p>
    </div>
  {% endif %}
</div>

<!-- Marketplace Promotion Section -->
<div class="container my-5">
  <div class="row">
    <div class="col-md-12">
      <div class="card shadow border-0 bg-gradient" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
        <div class="card-body text-white text-center p-5">
          <i class="fas fa-store fa-3x mb-3"></i>
          <h3 class="fw-bold mb-3">Student Marketplace</h3>
          <p class="lead mb-4">Buy and sell products with fellow students. Find textbooks, electronics, and more!</p>
          <div class="row">
            <div class="col-md-8 offset-md-2">
              <div class="row text-center">
                <div class="col-4">
                  <i class="fas fa-mobile-alt fa-2x mb-2"></i>
                  <p class="small">Mobile Phones</p>
                </div>
                <div class="col-4">
                  <i class="fas fa-book fa-2x mb-2"></i>
                  <p class="small">Textbooks</p>
                </div>
                <div class="col-4">
                  <i class="fas fa-laptop fa-2x mb-2"></i>
                  <p class="small">Electronics</p>
                </div>
              </div>
            </div>
          </div>
          <a href="{% url 'marketplace' %}" class="btn btn-light btn-lg mt-3">
            <i class="fas fa-shopping-cart me-2"></i> Visit Marketplace
          </a>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock main-content %}

{% block extra_scripts %}
{{ block.super }}
<style>
  /* Course Cards Styles */
  .course-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    border-radius: 15px;
    overflow: hidden;
  }
  
  .course-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1) !important;
  }
  
  .course-image {
    height: 200px;
    object-fit: cover;
    transition: transform 0.3s ease;
  }
  
  .course-image-placeholder {
    height: 200px;
  }
  
  .course-card:hover .course-image {
    transform: scale(1.05);
  }
  
  /* LMS Feature Card Styles */
  .bg-gradient {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
  }

  @media (max-width: 600px) {
    .course-card { width: 100%; }
  }
</style>
{% endblock %}